#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../../common/functions

# Connect as root
MYSQL_USER="root"
MYSQL_PASS=
MYSQL_PORT=3300
MYSQL_HOST="127.0.0.1"

# Find MySQL executable
CMD_DUMP_RECORDS="bin/mysql/dump/records"
CMD_DUMP_SCHEMA="bin/mysql/dump/schema"

# Database
MYSQL_DB_MAIN="xj"
MYSQL_DB_TEST="xj_test"

# Output
OUTPUT_PREFIX="${PWD}/.mysql/dump/"
OUTPUT_MAIN_SCHEMA_SQL="${OUTPUT_PREFIX}main.schema.sql"
OUTPUT_MAIN_RECORDS_SQL="${OUTPUT_PREFIX}main.records.sql"
OUTPUT_TEST_SCHEMA_SQL="${OUTPUT_PREFIX}test.schema.sql"

#
step "Dump main database schema"
${CMD_DUMP_SCHEMA} "${MYSQL_USER}" "${MYSQL_PASS}" "${MYSQL_DB_MAIN}" "${MYSQL_HOST}" "${MYSQL_PORT}" "${OUTPUT_MAIN_SCHEMA_SQL}"
step_ok

#
step "Dump main database records"
${CMD_DUMP_RECORDS} "${MYSQL_USER}" "${MYSQL_PASS}" "${MYSQL_DB_MAIN}" "${MYSQL_HOST}" "${MYSQL_PORT}" "${OUTPUT_MAIN_RECORDS_SQL}"
step_ok

#
step "Dump test database schema"
${CMD_DUMP_SCHEMA} "${MYSQL_USER}" "${MYSQL_PASS}" "${MYSQL_DB_TEST}" "${MYSQL_HOST}" "${MYSQL_PORT}" "${OUTPUT_TEST_SCHEMA_SQL}"
step_ok

#
finished_ok
