#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../../common/functions

# Connect as postgres
SQL_USER="postgres"
SQL_PASS=
SQL_PORT=5400
SQL_HOST="127.0.0.1"

# Commands
CMD_EXPORT_RECORDS="bin/sql/export/records"
CMD_EXPORT_SCHEMA="bin/sql/export/schema"

# Database
DB_MAIN=${1:-xj_dev}
SQL_DB_TEST="xj_test"

# Output
OUTPUT_PREFIX="${PWD}/ops/sql/export/"
OUTPUT_MAIN_SCHEMA_SQL="${OUTPUT_PREFIX}main.schema.sql"
OUTPUT_MAIN_RECORDS_SQL="${OUTPUT_PREFIX}main.records.sql"
OUTPUT_TEST_SCHEMA_SQL="${OUTPUT_PREFIX}test.schema.sql"

#
step "Will export main database schema"
echo "    ${CMD_EXPORT_SCHEMA} ${SQL_USER} ${SQL_PASS} ${DB_MAIN} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_MAIN_SCHEMA_SQL}"
${CMD_EXPORT_SCHEMA} "${SQL_USER}" "${SQL_PASS}" "${DB_MAIN}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_MAIN_SCHEMA_SQL}"
step_ok


step "Export main database records"
echo "    ${CMD_EXPORT_RECORDS} ${SQL_USER} ${SQL_PASS} ${DB_MAIN} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_MAIN_RECORDS_SQL}"
${CMD_EXPORT_RECORDS} "${SQL_USER}" "${SQL_PASS}" "${DB_MAIN}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_MAIN_RECORDS_SQL}"
step_ok

#
step "Export test database schema"
echo "    ${CMD_EXPORT_SCHEMA} ${SQL_USER} ${SQL_PASS} ${SQL_DB_TEST} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_TEST_SCHEMA_SQL}"
${CMD_EXPORT_SCHEMA} "${SQL_USER}" "${SQL_PASS}" "${SQL_DB_TEST}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_TEST_SCHEMA_SQL}"
step_ok

#
finished_ok
