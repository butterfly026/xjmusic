#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../../common/functions

# Connect as postgres
SQL_USER="postgres"
SQL_PASS="postgres"
SQL_PORT=5432
SQL_HOST="127.0.0.1"

# Commands
CMD_BACKUP_RECORDS="bin/sql/backup/records"
CMD_BACKUP_SCHEMA="bin/sql/backup/schema"

# Database
DB_MAIN=${1:-xj_dev}
SQL_DB_TEST="xj_test"

# Output
OUTPUT_PREFIX="${PWD}/backup/"
OUTPUT_MAIN_SCHEMA_SQL="${OUTPUT_PREFIX}main.schema.sql"
OUTPUT_MAIN_RECORDS_SQL="${OUTPUT_PREFIX}main.records.sql"
OUTPUT_TEST_SCHEMA_SQL="${OUTPUT_PREFIX}test.schema.sql"

#
step "Will backup main database schema"
echo "    ${CMD_BACKUP_SCHEMA} ${SQL_USER} ${SQL_PASS} ${DB_MAIN} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_MAIN_SCHEMA_SQL}"
${CMD_BACKUP_SCHEMA} "${SQL_USER}" "${SQL_PASS}" "${DB_MAIN}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_MAIN_SCHEMA_SQL}"
step_ok


step "Backup main database records"
echo "    ${CMD_BACKUP_RECORDS} ${SQL_USER} ${SQL_PASS} ${DB_MAIN} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_MAIN_RECORDS_SQL}"
${CMD_BACKUP_RECORDS} "${SQL_USER}" "${SQL_PASS}" "${DB_MAIN}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_MAIN_RECORDS_SQL}"
step_ok

#
step "Backup test database schema"
echo "    ${CMD_BACKUP_SCHEMA} ${SQL_USER} ${SQL_PASS} ${SQL_DB_TEST} ${SQL_HOST} ${SQL_PORT} ${OUTPUT_TEST_SCHEMA_SQL}"
${CMD_BACKUP_SCHEMA} "${SQL_USER}" "${SQL_PASS}" "${SQL_DB_TEST}" "${SQL_HOST}" "${SQL_PORT}" "${OUTPUT_TEST_SCHEMA_SQL}"
step_ok

#
finished_ok
