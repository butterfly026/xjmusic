#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/../common/functions

error() {
  echo "Failed!"
  exit 1
}

# Connect as root
SQL_USER="root"
SQL_PORT=5400
SQL_HOST="127.0.0.1"

# Database
SQL_DB_MAIN="xj_prod"

# Command
TRUNCATE_CHAIN_SQL="truncate xj.segment, xj.segment_choice, xj.segment_choice_arrangement, xj.segment_choice_arrangement_pick, xj.segment_chord, xj.segment_meme, xj.segment_message, xj.chain, xj.chain_binding, xj.chain_config;"

# Config
CFG="--user=${SQL_USER} --host=${SQL_HOST} --port=${SQL_PORT}"

#
step "Truncate Chains"
psql ${CFG} ${SQL_DB_MAIN} -c "${TRUNCATE_CHAIN_SQL}" || error
step_ok

#
finished_ok
