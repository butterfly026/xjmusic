#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/common/functions

#
APPS=$(grep -oE '<module>([a-z]*)</module>' ${PWD}/pom.xml | sed 's/<module>//g' | sed 's/<\/module>//g')

#
step "Modules:"
indent "${APPS}"
step_ok

#
step "Searching for loose system properties"
for APP in ${APPS}; do
  if ack-grep --ignore-file='match:/Test.java/' \
              --ignore-file='match:/Config.java/' \
              --heading --color -o \
              'System.getProperty\(([^\)]+)\)' \
              ${PWD}/${APP}; then
    printf "\n${RED}ERROR!${RESET}\nPlease ensure that all app configuration implements ${GREEN}io.xj.core.config${RESET}.\nThere should be no loose System.getProperty().\n\n"
    exit 1
  fi
done
step_ok

#
step "io.xj.core.config.Config properties:"
indent "$(grep -oE "\"[a-z]+\.[a-z\.]+\"" core/src/main/java/io/outright/xj/core/app/config/Config.java | sort)"
step_ok

#
finished_ok
