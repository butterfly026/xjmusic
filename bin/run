#!/usr/bin/env bash

# Include common functions
. $( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )/common/functions

# Title & Usage
TITLE="Run App"
USAGE="
   Usage:
     bin/run <app> <arguments...>

   <app> to run, as in: java io.xj.<app>
   <arguments...> (optional) passed to 'java'
"

# Must specify <app> argument
APP=$1
if [ "${APP}" == "" ]; then
  printf "${RED}ERROR!${RESET} Please specify a app.\n"
  echo "${USAGE}"
  exit 1
fi
shift

# App Arguments
APP_ARGS=$@

# Expected JAR files
APP_JAR=${PWD}/target/${APP}-1.0-jar-with-dependencies.jar
CONFIG_PATH="env.conf"
CLASSPATH=${APP_JAR}

# ensure platform is packaged
ensure_file ${APP_JAR} "${APP} is packaged"

# start up a ${APP}
if ["$@" == ""]; then
  CMD="
  /usr/bin/java
    -jar ${APP_JAR}
    ${CONFIG_PATH}
  "
else
  CMD="
  /usr/bin/java
    $@
    -jar ${APP_JAR}
    ${CONFIG_PATH}
  "
fi

step "Java Execution"
execute "${CMD}"

#
finished_ok
