#!/usr/bin/env bash

#
message_prefix="[site/xj]"

# color output
RED=`tput setaf 1`
GREEN=`tput setaf 2`
RESET=`tput sgr0`

# Title & Usage
TITLE="build & push latest version of site to source repo and S3 distribution"
USAGE="
   Usage:
     bin/publish <message>

   <message> to commit and push to repo
"

# Must specify <message> argument
message=$1
if [ "${message}" == "" ]; then
  printf "${RED}ERROR!${RESET} Please specify a message.\n"
  echo "${USAGE}"
  exit 1
fi
shift

# do it and exit if any step fails
gulp || exit 1
hugo || exit 1
git add --all || exit 1
git commit -m"${message_prefix} ${message}" # this step can fail, if there happened to be nothing to commit
git push || exit 1
s3_website push || exit 1
