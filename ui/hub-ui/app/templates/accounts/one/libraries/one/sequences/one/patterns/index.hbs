<!-- Copyright (c) 2018, XJ Music Inc. (https://xj.io) All Rights Reserved. -->

<!-- Inner Content -->
{{outlet}}

<div class="form-horizontal container-fluid">

  {{#if (or auth.isArtist auth.isAdmin)}}
    <div class="col-sm-12 text-right">
      {{#link-to 'accounts.one.libraries.one.sequences.one.patterns.new' model.sequence.library.account model.sequence.library model.sequence}}{{fa-icon "plus"}} Create New Pattern{{/link-to}}
    </div>
  {{/if}}

  <!-- List of Sections -->
  <div class="col-sm-12">
    <div class="table-list">
      <table class="table">
        <thead>
        <tr>
          <th width="1%">Type</th>
          <th width="1%">Total</th>
          <th>Name</th>
          <th width="1%">Key</th>
          <th width="1%">Density</th>
          <th width="1%">Tempo</th>
          <th><!-- Actions --></th>
          <th width="1%">#</th>
        </tr>
        </thead>
        <tbody>
        {{#each model.patterns as |pattern|}}
          <tr class="item">
            <td>{{pattern.type}}</td>
            <td>{{pattern.total}}</td>
            <td>{{#link-to 'accounts.one.libraries.one.sequences.one.patterns.one' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}{{pattern.name}}{{/link-to}}</td>
            <td>{{pattern.key}}</td>
            <td>{{pattern.density}}</td>
            <td>{{pattern.tempo}}</td>
            <td>
              {{#link-to 'accounts.one.libraries.one.sequences.one.patterns.one.memes' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}Memes{{/link-to}}<span>&nbsp;</span>
              {{#if (not-eq pattern.sequence.type "Macro")}}
                {{#link-to 'accounts.one.libraries.one.sequences.one.patterns.one.chords' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}Chords{{/link-to}}<span>&nbsp;</span>
                {{#link-to 'accounts.one.libraries.one.sequences.one.patterns.one.events' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}Events{{/link-to}}<span>&nbsp;</span>
                {{#if (eq pattern.sequence.type "Rhythm")}}{{#link-to 'accounts.one.libraries.one.sequences.one.patterns.one.stepmatic' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}Stepmatic{{/link-to}}<span>&nbsp;</span>{{/if}}
              {{/if}}
              {{entity-actions 'accounts.one.libraries.one.sequences.one.patterns.one' 'edit|clone|destroy' pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}
            </td>
            <th scope="row">{{#link-to "accounts.one.libraries.one.sequences.one.patterns.one"
                                       pattern.sequence.library.account pattern.sequence.library pattern.sequence pattern}}{{pattern.id}}{{/link-to}}</th>
          </tr>
        {{/each}}
        </tbody>
      </table>
    </div>
  </div>

</div>

{{#if (or (eq "Macro" model.sequence.type) (eq "Main" model.sequence.type))}}
  <!-- Container -->
  <div class="form-horizontal container-fluid">

    <!-- Info -->
    <div class="row">
      <div class="col-sm-12">
        <h2>Pattern Order</h2>
        <p>After creating patterns, use the controls below to bind your patterns to the sequence in a particular
          order.</p>
      </div>
    </div>

    <!-- List records, else display message -->
    <div class="row">
      {{#if model.sequencePatterns.length}}
        <div class="col-sm-12">
          <div class="table-list">
            <table class="table">
              <thead>
              <tr>
                <th>Offset</th>
                <th>Name</th>
                <th>&nbsp;</th>
              </tr>
              </thead>
              <tbody>
              {{#each model.sequencePatterns as |sequencePattern|}}
                <tr>
                  <td>{{sequencePattern.offset}}</td>
                  <td>{{sequencePattern.pattern.name}}</td>
                  <td>
                    <button {{action "removePattern" sequencePattern}}>Remove</button>
                  </td>
                </tr>
              {{/each}}
              </tbody>
            </table>
          </div>
        </div>
      {{else}}
        <div class="col-sm-12">
          <p>Please bind some patterns to determine their selection order.</p>
        </div>
      {{/if}}
    </div>

    <div class="form-group row">
      <label class="col-sm-2 control-label">Select Pattern to bind</label>
      <div class="col-sm-10">
        <!--input type="text" value=model.newSequencePattern.patternId class="form-control" autofocus="autofocus"-->
        <!--placeholder="Pattern ID to grant access"}}-->
        {{#power-select
          placeholder="Select Pattern"
          options=model.patterns
          selected=model.patternToAdd
          searchField='name'
          onchange=(action "setPatternToAdd")
        as |pattern| }}
          {{pattern.name}}
        {{/power-select}}
      </div>
    </div>

    <div class="form-group row">
      <label class="col-sm-2 control-label">Offset</label>
      <div class="col-sm-10">
        {{input type="text" value=model.offsetToAdd class="form-control" autofocus="autofocus"}}
      </div>
    </div>

    <div class="form-group row">
      <div class="offset-sm-2 col-sm-10">
        <button type="submit" class="btn btn-default" {{action 'addPattern' model}}>Bind Pattern to
          Sequence
        </button>
      </div>
    </div>

  </div>
{{/if}}
