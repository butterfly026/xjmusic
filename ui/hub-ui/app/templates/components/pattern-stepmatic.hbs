<!-- Copyright (c) 2018, XJ Music Inc. (https://xj.io) All Rights Reserved. -->

<div class="form-horizontal container-fluid pattern-stepmatic {{only-if isDirty 'dirty'}}">

  <!--
  --
  Stepmatic meta-controls (upper)
  --
  -->
  <div class="form-group row meta">

    {{#if isWorking}}

      <label class="col-xl-1 col-lg-1 col-sm-2 control-label">{{workStatus}}</label>
      <div class="col-xl-11 col-lg-11 col-sm-10">
        <div class="loader">&nbsp;</div>
      </div>

    {{else}}

      <label class="col-xl-1 col-lg-1 col-sm-2 control-label"><span data-toggle="tooltip"
                                                                    title="Modify # of beats in a measure, and re-compute events from original pattern.">Measure</span></label>
      <div class="col-xl-1 col-lg-1 col-sm-10">
        {{input type="number" value=pattern.meterSuper class="form-control" autofocus="autofocus"
                placeholder="beats" change=(action "didUpdateSuper")
                data-toggle="tooltip" title="# of beats in a measure"}}
      </div>

      <label class="col-xl-1 col-lg-1 col-sm-2 control-label"><span data-toggle="tooltip"
                                                                    title="Modify # of steps to divide each beat, and re-compute events from original pattern.">Subdiv</span></label>
      <div class="col-xl-1 col-lg-1 col-sm-10">
        {{input type="number" value=pattern.meterSub class="form-control" autofocus="autofocus"
                placeholder="divs" change=(action "didUpdateSub")
                data-toggle="tooltip" title="# steps to divide each beat"}}
      </div>

      <label class="col-xl-1 col-lg-1 col-sm-2 control-label"><span data-toggle="tooltip"
                                                                    title="Modify % delay of each odd step.">Swing</span></label>
      <div class="col-xl-1 col-lg-1 col-sm-10">
        {{input type="number" value=pattern.meterSwing class="form-control" autofocus="autofocus"
                placeholder="%"  change=(action "didUpdateSwing")
                data-toggle="tooltip" title="% delay of each odd step"}}
      </div>

      <div class="ml-auto col-xl-1 col-lg-2 col-sm-4">
        <button class="btn btn-dark" data-toggle="tooltip" title="Clear all grid events and re-compute events from original pattern." {{action 'clear' pattern}}>Clear</button>
      </div>
      <div class="col-xl-1 col-lg-2 col-sm-4">
        <button class="btn btn-dark" data-toggle="tooltip" title="Revert all grid events and revert to events from original pattern." {{action 'revert' pattern}}>Revert</button>
      </div>
      <div class="col-xl-1 col-lg-2 col-sm-4">
        <button class="btn btn-success" data-toggle="tooltip" title="Apply all grid events to pattern." {{action 'apply' pattern}}>Apply</button>
      </div>

    {{/if}}

  </div>

  <!--
  --
  Stepmatic grid
  --
  -->
  <div class="form-group row">
    <div class="col-12">

      <div class="grid">
        {{#each-in grid as |groupId groupContainer|}}
          <div class="track-group">

            {{#each-in groupContainer.tracks as |track steps|}}
              <div class="track">
                <div {{action 'addTrack' groupId}} class="group-name"
                                                   data-toggle="tooltip"
                                                   title="create a track in {{groupContainer.group.description}}">
                  {{groupContainer.group.description}}
                </div>
                <div class="track-name">
                  {{track}}
                </div>
                {{#each-in steps as |step event|}}
                  <div class="step velocity-{{velocity-decascale event.velocity}} {{grid-step-modulo step meter.super
                                                                                                     meter.sub}}-type"
                       onclick={{action 'onStepTouch' groupId track step}}
                  >&nbsp;
                  </div>
                {{/each-in}}
              </div>

            {{else}}
              <div class="track">
                <div {{action 'addTrack' groupId}} class="group-name"
                                                   data-toggle="tooltip"
                                                   title="create a track in {{groupContainer.group.description}}">
                  {{groupContainer.group.description}}
                </div>
              </div>
            {{/each-in}}

          </div>
        {{/each-in}}
      </div>

    </div>
  </div>


  <!--
  --
  [#160356534] Stepmatic instructions
  --
  -->
  <div class="form-group row">
    <div class="col-12">
      <table class="table instructions">
        <thead>
        <tr>
          <th scope="col"><h3>Legend</h3></th>
          <th scope="col">&nbsp;</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <th scope="row"><em>Tap on grid</em></th>
          <td>Toggle step value: 1, {{fraction 2 3}}, {{fraction 1 3}}, {{fraction 1 10}}, {{fraction 1 20}}, or 0</td>
        </tr>
        <tr>
          <th scope="row"><em>Double-tap grid</em></th>
          <td>Clear step value.</td>
        </tr>
        <tr>
          <th scope="row"><em>Triple-tap grid</em></th>
          <td>Set exact step value.</td>
        </tr>
        <tr>
          <th scope="row"><em>Tap on group</em></th>
          <td>Create new drum track in group.</td>
        </tr>
        <tr>
          <th scope="row">Measure</th>
          <td># of beats in a measure</td>
        </tr>
        <tr>
          <th scope="row">Subdiv</th>
          <td># of steps to divide each beat</td>
        </tr>
        <tr>
          <th scope="row">Swing</th>
          <td>% delay of each odd step</td>
        </tr>
        <tr>
          <th scope="row">
            <div class="btn btn-sm btn-instructions">Clear</div>
          </th>
          <td>all grid events and re-compute events from original pattern.</td>
        </tr>
        <tr>
          <th scope="row">
            <div class="btn btn-sm btn-instructions">Revert</div>
          </th>
          <td>all grid events and revert to events from original pattern.</td>
        </tr>
        <tr>
          <th scope="row">
            <div class="btn btn-sm btn-instructions">Apply</div>
          </th>
          <td>all grid events to pattern.</td>
        </tr>
        </tbody>
      </table>

    </div>
  </div>

</div>

<!-- Inner content -->
{{yield}}