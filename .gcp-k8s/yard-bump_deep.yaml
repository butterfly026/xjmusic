apiVersion: v1
kind: List
items:
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        k8s-app: bump-deep-nexus
      name: bump-deep-nexus
      namespace: yard
    spec:
      progressDeadlineSeconds: 600
      replicas: 1
      selector:
        matchLabels:
          k8s-app: bump-deep-nexus
      strategy:
        type: Recreate
      template:
        metadata:
          labels:
            k8s-app: bump-deep-nexus
        spec:
          automountServiceAccountToken: true
          containers:
            - env:
                - name: SHIP_KEY
                  value: bump_deep
                - name: SHIP_CHUNK_AUDIO_ENCODER
                  value: mp3
                - name: SHIP_CHUNK_CONTENT_TYPE
                  value: audio/mpeg
              envFrom:
                - secretRef:
                    name: prod.env
              image: gcr.io/xj-vpc-host-prod/nexus:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 3
                httpGet:
                  path: /healthz
                  port: 3000
                  scheme: HTTP
                initialDelaySeconds: 60
                periodSeconds: 5
                successThreshold: 1
                timeoutSeconds: 1
              name: bump-deep-nexus
              resources:
                requests:
                  cpu: "1.5"
                  memory: 4G
                limits:
                  cpu: "2.5"
                  memory: 6G
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
          dnsPolicy: ClusterFirst
          enableServiceLinks: true
          restartPolicy: Always
          schedulerName: default-scheduler
          securityContext: { }
          shareProcessNamespace: false
          terminationGracePeriodSeconds: 30
  - apiVersion: apps/v1
    kind: Deployment
    metadata:
      labels:
        k8s-app: bump-deep-ship
      name: bump-deep-ship
      namespace: yard
    spec:
      progressDeadlineSeconds: 600
      replicas: 1
      strategy:
        type: RollingUpdate
        rollingUpdate:
          maxSurge: 1
      selector:
        matchLabels:
          k8s-app: bump-deep-ship
      template:
        metadata:
          labels:
            k8s-app: bump-deep-ship
        spec:
          automountServiceAccountToken: true
          containers:
            - env:
                - name: SHIP_KEY
                  value: bump_deep
              envFrom:
                - secretRef:
                    name: prod.env
              image: gcr.io/xj-vpc-host-prod/ship:latest
              imagePullPolicy: Always
              livenessProbe:
                failureThreshold: 3
                httpGet:
                  path: /healthz
                  port: 3000
                  scheme: HTTP
                initialDelaySeconds: 30
                periodSeconds: 5
                successThreshold: 1
                timeoutSeconds: 1
              name: bump-deep-ship
              resources:
                requests:
                  cpu: "1.25"
                  memory: 3G
                limits:
                  cpu: "2.5"
                  memory: 5Gi
              terminationMessagePath: /dev/termination-log
              terminationMessagePolicy: File
          dnsPolicy: ClusterFirst
          enableServiceLinks: true
          restartPolicy: Always
          schedulerName: default-scheduler
          securityContext: { }
          shareProcessNamespace: false
          terminationGracePeriodSeconds: 30
